/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/@microsoft/signalr@6.0.4/dist/esm/FetchHttpClient.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{AbortError,HttpError,TimeoutError}from"./Errors";import{HttpClient,HttpResponse}from"./HttpClient";import{LogLevel}from"./ILogger";import{Platform,getGlobalThis}from"./Utils";export class FetchHttpClient extends HttpClient{constructor(e){if(super(),this._logger=e,"undefined"==typeof fetch){const e="function"==typeof __webpack_require__?__non_webpack_require__:require;this._jar=new(e("tough-cookie").CookieJar),this._fetchType=e("node-fetch"),this._fetchType=e("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(getGlobalThis());if("undefined"==typeof AbortController){const e="function"==typeof __webpack_require__?__non_webpack_require__:require;this._abortControllerType=e("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new AbortError;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let r;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),r=new AbortError});let o,i=null;if(e.timeout){const o=e.timeout;i=setTimeout((()=>{t.abort(),this._logger.log(LogLevel.Warning,"Timeout from HTTP request."),r=new TimeoutError}),o)}try{o=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:!0===e.withCredentials?"include":"same-origin",headers:{"Content-Type":"text/plain;charset=UTF-8","X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(e){if(r)throw r;throw this._logger.log(LogLevel.Warning,`Error from HTTP request. ${e}.`),e}finally{i&&clearTimeout(i),e.abortSignal&&(e.abortSignal.onabort=null)}if(!o.ok){const e=await deserializeContent(o,"text");throw new HttpError(e||o.statusText,o.status)}const n=deserializeContent(o,e.responseType),a=await n;return new HttpResponse(o.status,o.statusText,a)}getCookieString(e){let t="";return Platform.isNode&&this._jar&&this._jar.getCookies(e,((e,r)=>t=r.join("; "))),t}}function deserializeContent(e,t){let r;switch(t){case"arraybuffer":r=e.arrayBuffer();break;case"text":default:r=e.text();break;case"blob":case"document":case"json":throw new Error(`${t} is not supported.`)}return r}
//# sourceMappingURL=/sm/de762b0a734e995bc34f3c9ee6f6b88454fca71abfd13058138f3bcdba904738.map